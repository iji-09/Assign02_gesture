# Assignment01을 기반으로 한 Assignment02


# 🚦 손 제스처 기반 신호등 제어 시스템 (Arduino + p5.js)

## 아두이노 & p5.js 동작 영상


[![프로젝트 시연 영상](https://youtu.be/AYkG0jfUNxg?si=NCOf9eZCbI0TgNwX)



---


## 프로젝트 개요

이 프로젝트는 **아두이노(Arduino)** 와 **p5.js (웹 기반 인터페이스)** 를 시리얼 통신으로 연동하여,  
**웹캠으로 손 제스처를 인식하거나 버튼을 누르거나 슬라이더를 조절**해서 신호등을 제어할 수 있도록 만든 인터랙티브 시스템입니다.

---

## 시스템 구성

| 구성 요소 | 설명 |
|-----------|------|
| Arduino Uno | LED와 버튼이 연결되어 있으며, 신호등 동작을 담당합니다 |
| LED 3개 | 빨강, 노랑, 초록불 제어 |
| 버튼 3개 | 각 버튼마다 다른 모드 실행 (버튼 1: 빨간불, 버튼 2: 전체 깜빡이기, 버튼 3: 신호등 다시 시작) |
| 가변저항 | LED 밝기 조절 |
| p5.js + ml5.js | 손 제스처 인식 및 슬라이더/버튼 UI, 아두이노와의 시리얼 통신 |
| Handpose 모델 | 손가락 위치를 추적하여 제스처를 인식 |

---

## 주요 기능

### 신호등 기본 기능
- 빨간불 → 노란불 → 초록불 → 깜빡이는 초록불 → 노란불 → 다시 빨간불 순서로 반복됩니다.
- 각 불의 지속 시간은 슬라이더 또는 시리얼 명령으로 조절할 수 있습니다.

### 모드 전환
| 모드 | 실행 방법 | 설명 |
|------|-----------|------|
| 기본 신호등 모드 | 기본 상태 or 버튼3 | 일반적인 신호등 순환 동작 |
| 빨간불 전용 모드 | 버튼1 or 제스처(🤙) | 빨간불만 켜짐 |
| 전체 깜빡이기 모드 | 버튼2 or 제스처(👆) | 모든 LED가 깜빡임 |
| 신호등 OFF | 버튼3 다시 누르기 or 제스처(👌) | 모든 LED OFF, 기능 멈춤 |

---

## ✋ 제스처 인식 기능

웹캠에서 손을 인식하여 아래 제스처에 따라 기능이 실행됩니다:

| 제스처 | 의미 | 동작 |
|--------|------|------|
| ✊ 주먹 | 슬라이더 선택 | 빨간불 시간 조절 |
| ✌️ 브이 | 슬라이더 선택 | 노란불 시간 조절 |
| 🖐 손바닥 | 슬라이더 선택 | 초록불 시간 조절 |
| 🤙 엄지검지 | 버튼1 기능 | 빨간불 전용 모드 On/Off |
| 👆 검지만 펴기 | 버튼2 기능 | 전체 깜빡이기 On/Off |
| 👌 OK 포즈 | 버튼3 기능 | 신호등 On/Off 전환 |

슬라이더를 선택한 뒤 손을 좌우로 움직이면 해당 슬라이더 값이 변경되고,  
바뀐 값은 자동으로 아두이노에 전송됩니다.

---

## 시리얼 통신 명령 (p5.js ↔ Arduino)

| 명령어 | 의미 |
|--------|------|
| `1` | 신호등 시작 |
| `0` | 신호등 종료 |
| `r` | 빨간불 전용 모드 시작 |
| `b` | 전체 LED 깜빡이기 모드 시작 |
| `BRIGHTNESS_SET:숫자` | LED 밝기 설정 (0~255) |
| `TIMING:RED=2000,YELLOW=500,GREEN=2000` | 각 불의 지속 시간 설정 (단위: ms) |

Arduino는 신호등 상태를 다음처럼 p5.js로 보내고, p5.js는 UI에 반영합니다:

```
RED
YELLOW
GREEN
GREENBLINK
YELLOW2
BUTTON1_ON / OFF
BUTTON2_ON / OFF
BUTTON3_ON / OFF
BRIGHTNESS:255
```

---

## 실행 방법

1. **Arduino IDE**에서 아두이노 코드를 업로드합니다.
2. **p5.js 웹 인터페이스**에서 시리얼 연결 버튼을 클릭하여 Arduino와 연결합니다.
3. 슬라이더 또는 제스처로 신호등을 조절하고, 버튼을 눌러 모드를 전환할 수 있습니다.

---

## 코드 작동 원리

### 전체 흐름 요약

```
p5.js (웹 UI) ↔ 아두이노 (신호등 제어)  
        ↑                         ↓  
   슬라이더 조절           밝기/버튼 상태 전송
   버튼 클릭               신호등 상태 전송
   제스처 제어
```

### 주요 변수 및 구조

- `brightness`, `redTime`, `yellowTime`, `greenTime`  
  → p5.js에서 슬라이더로 제어하며 아두이노로 전송됨

- `currentLight`, `mode`  
  → 현재 신호등 색상과 모드 상태를 저장 (red, yellow, green 등)

- `hands[]`, `activeSlider`, `lastGestureTime`  
  → ml5.js Handpose 모델로 손 제스처 인식하여 슬라이더나 버튼을 제어

---

### 시리얼 통신 방식

#### p5.js → Arduino 전송 형식
| 명령 | 설명 |
|------|------|
| `"1"` | 신호등 기능 시작 |
| `"0"` | 신호등 기능 정지 |
| `"r"` | 빨간불만 켜기 |
| `"b"` | 모든 LED 깜빡이기 |
| `"BRIGHTNESS_SET:[값]"` | LED 밝기 설정 |
| `"TIMING:RED=[값],YELLOW=[값],GREEN=[값]"` | 각 색상의 점등 시간 설정 |

#### Arduino → p5.js 전송 형식
| 데이터 | 설명 |
|--------|------|
| `"RED"` | 빨간불 상태 전송 |
| `"YELLOW"` | 노란불 상태 전송 |
| `"GREEN"` | 초록불 상태 전송 |
| `"GREENBLINK"` | 초록불 깜빡이기 상태 전송 |
| `"YELLOW2"` | 두 번째 노란불 상태 |
| `"BRIGHTNESS:[값]"` | 가변저항으로 읽은 밝기 값 |
| `"BUTTON1_ON"`, `"BUTTON1_OFF"` | 버튼 1 상태 전송 |
| `"BUTTON2_ON"`, `"BUTTON2_OFF"` | 버튼 2 상태 전송 |
| `"BUTTON3_ON"`, `"BUTTON3_OFF"` | 버튼 3 상태 전송 |

---

### 동작 방식 요약

#### 1. p5.js (웹 인터페이스)

- **setup()**  
  - 슬라이더, 버튼 생성  
  - Handpose 모델 로드  
  - 시리얼 포트 연결 준비

- **draw()**  
  - 신호등 상태 UI 출력  
  - 손 제스처 인식 및 슬라이더/버튼 제어  
  - 신호등 상태에 따라 `updateTrafficLight()` 실행

- **제스처로 슬라이더 제어**  
  - ✊: 빨간불 슬라이더  
  - ✌️: 노란불 슬라이더  
  - 🖐: 초록불 슬라이더  
  - 손 좌우 이동으로 값 조절

- **제스처로 버튼 기능 실행**  
  - 🤙: 빨간불 전용 모드  
  - 👆: 모든 LED 깜빡이기  
  - 👌: 신호등 켜기/끄기

#### 2. 아두이노 (Task 기반 제어)

- `TaskScheduler` 라이브러리로 빨강 → 노랑 → 초록 → 깜빡임 → 노랑 순서 자동 실행

- 각 Task는 다음처럼 동작:
  - `red()` → 2초 후 `yellow1()` 실행  
  - `yellow1()` → 0.5초 후 `green()` 실행  
  - `green()` → 2초 후 `greenBlink()` 실행  
  - `greenBlink()` → 6번 깜빡임 후 `yellow2()` 실행  
  - `yellow2()` → 다시 `red()`로 순환

- 밝기 조절은 **가변저항(POT)** 또는 p5.js 슬라이더를 통해  
  → `analogWrite(pin, 밝기)` 로 적용됨

- 버튼 인터럽트를 사용하여 **즉시 모드 전환** 가능  
  → 버튼 누르면 Task 중단 후 해당 기능 실행

---

## 주요 함수 설명

---

### p5.js 주요 함수

| 함수 이름 | 설명 |
|-----------|------|
| `setup()` | p5.js의 기본 초기화 함수. 캔버스 생성, 버튼 및 슬라이더 설정, Handpose 모델 로드, 시리얼 포트 준비 등을 수행 |
| `draw()` | 매 프레임마다 호출되는 함수. 신호등 UI 그리기, 제스처 인식, 신호등 상태 업데이트 등의 역할 수행 |
| `connectBtnClick()` | 사용자가 "아두이노 연결" 버튼을 클릭하면 실행됨. 사용 가능한 시리얼 포트에 연결하거나 연결 해제 |
| `readSerialData()` | 시리얼 포트로부터 들어오는 데이터를 계속해서 읽으며, 한 줄씩 처리하여 `updateTrafficState()`에 전달 |
| `updateTrafficState(data)` | 아두이노에서 보낸 데이터를 기반으로 p5.js 내부 상태 업데이트 (LED 상태, 버튼 상태 등) |
| `sendSerialData(data)` | p5.js → Arduino로 문자열 형태의 데이터를 전송하는 함수 |
| `sendBrightnessData()` | 슬라이더로 조절한 밝기 값을 아두이노로 전송 |
| `sendTimingData()` | 슬라이더로 조절한 신호등 점등 시간(R/Y/G)을 아두이노로 전송 |
| `toggleRedOnly()` | 빨간불 only 기능을 토글 (on/off) |
| `toggleBlinking()` | 모든 LED 깜빡이기 기능을 토글 (on/off) |
| `toggleTraffic()` | 기본 신호등 기능을 켜거나 끄는 기능 |
| `updateTrafficLight()` | 현재 `currentLight` 값에 따라 신호등 상태를 시간 기반으로 순환 |
| `detectGestureAndControlSlider()` | 손 제스처 인식 결과에 따라 슬라이더 선택 및 버튼 기능 실행 |
| `drawHandKeypoints()` | Handpose 모델이 감지한 손가락 위치에 점(원)을 표시 |
| `drawTrafficLights()` | 현재 신호등 상태에 맞춰 UI 상의 LED 점등 상태를 시각적으로 표현 |
| `blinkAllLEDs()` | 모든 LED를 일정 주기로 깜빡이도록 UI에 표시 (모드: all-blink) |

---

### Arduino 주요 함수

| 함수 이름 | 설명 |
|-----------|------|
| `setup()` | 아두이노 시작 시 한 번 실행. 핀모드 설정, 인터럽트 등록, 시리얼 시작, 신호등 첫 Task 시작 |
| `loop()` | 아두이노 메인 루프. TaskScheduler 실행, 밝기 측정 및 전송, 시리얼 명령 처리 |
| `adjustBrightness()` | 가변저항으로부터 밝기 값을 읽고, 현재 점등 중인 LED에 PWM 적용 |
| `processSerialInput()` | 시리얼 입력을 처리하여 밝기 조절, 주기 설정, LED 제어 명령을 수행 |
| `stopAllTask()` | 현재 실행 중인 모든 Task를 중단하고 모든 LED를 끔 |
| `stopState()` | 모든 상태 변수(B1, B2, B3, Traffic)를 false로 초기화 |
| `Restart_Traffic()` | 신호등 기능 재시작. 빨간불 Task부터 다시 시작함 |
| `button1Interrupt()` | 버튼1 (Red only) 눌렀을 때의 인터럽트 처리 함수 |
| `button2Interrupt()` | 버튼2 (모든 LED 깜빡이기) 눌렀을 때의 인터럽트 처리 함수 |
| `button3Interrupt()` | 버튼3 (신호등 On/Off) 눌렀을 때의 인터럽트 처리 함수 |
| `redOE() ~ yellow2OD()` | Task의 시작 조건, 콜백 함수, 종료 시 실행되는 함수들로 구성. 신호등 점등 순서를 TaskScheduler를 통해 처리 |
| `allLEDBlinkCB()` | 깜빡이기 모드에서 호출되는 Task 콜백. LED 상태를 반전시켜 깜빡이게 함 |
| `allLEDBlinkOD()` | 깜빡이기 모드가 끝났을 때 모든 LED를 끔 |

---





# 🚦 Assignment01_Traffic

## 아두이노 동작 영상


[![프로젝트 시연 영상](https://img.youtube.com/vi/yyEh_2ObcgM/0.jpg)](https://www.youtube.com/watch?v=yyEh_2ObcgM)



---

## 구현 기능

- 🟥 **빨간불 2초 유지**
- 🟨 **첫 번째 노란불 0.5초 유지**
- 🟩 **초록불 2초 유지**
- 🟩 **초록 깜빡임 3회 (1초 동안 166ms 간격)**
- 🟨 **두 번째 노란불 0.5초 유지**
- 💡 **밝기 조절 기능**
- 🚦 **p5.js UI에서 신호등 조작**
- 🔄 **아두이노 ↔ p5.js 양방향 통신**
- 🔘 **버튼으로 신호등 제어 가능 (Red only, Blink, On/Off)**

---

## 하드웨어 설명

### 버튼 연결

총 3개의 버튼이 사용되며, **각 버튼은 아두이노의 디지털 입력 핀과 연결**되어 있습니다.

| 버튼 번호 | 아두이노 핀 | 기능 |
|-----------|-----------|----------------|
| **1번 버튼** | `D4` | Red LED만 점등 / 신호등 기본기능 재시작 |
| **2번 버튼** | `D5` | 모든 LED 깜빡이기 / 신호등 기본기능 재시작 |
| **3번 버튼** | `D6` | 신호등 기본기능 on/off |

**각 버튼은 `INPUT_PULLUP` 모드로 설정되어 있어, 눌렀을 때 LOW 신호를 감지합니다.**  
**인터럽트를 활용하여 버튼을 누를 때마다 즉각적인 반응이 가능하도록 구현되었습니다.**

---

### LED 연결

각 신호등 LED는 아두이노의 **PWM 지원 디지털 핀**에 연결되어 있으며, `analogWrite()` 를 통해 밝기를 조절할 수 있습니다.

| LED 색상 | 아두이노 핀 | 역할 |
|-----------|-----------|----------------|
| **빨간 LED** | `D9` | 신호등 기본기능 (2초) |
| **노란 LED** | `D10` | 신호등 기본기능1 (0.5초) |
| **초록 LED** | `D11` | 신호등 기본기능 (2초), 깜빡임(6회) |
| **노란 LED** | `D10` | 신호등 기본기능2 (0.5초) |

**PWM을 사용하여 밝기를 조절할 수 있도록 설정되었습니다.**

---

### 밝기 조절용 가변저항 (Potentiometer)

신호등 LED의 밝기는 **가변저항(Potentiometer)** 를 사용하여 조절됩니다.

| 구성 요소 | 아두이노 핀 | 역할 |
|-----------|-----------|----------------|
| **가변저항** | `A0` (아날로그 입력) | LED 밝기 조절 |
| **전원 연결** | `5V` 및 `GND` | 아두이노에서 전력 공급 |

**아날로그 입력 핀(`A0`)에서 값을 읽어 0-1023 범위의 값을 받아 0-255로 변환하여 LED 밝기를 조절합니다.**  
**`map()` 함수를 사용하여 가변저항의 입력값을 LED의 `analogWrite()` 값으로 변환합니다.**

---

### 핀 연결 세부사항

| 핀 번호 | 연결된 부품 | 설명 |
|--------|------------|------------------------------------------------|
| **D9**  | 초록 LED(Green) | PWM 출력 핀, 가변저항을 통해 밝기 제어 가능 |
| **D10** | 노랑 LED(Yellow) | PWM 출력 핀, 가변저항을 통해 밝기 제어 가능 |
| **D11** | 빨강 LED(Red) | PWM 출력 핀, 가변저항을 통해 밝기 제어 가능 |
| **D4**  | 버튼1 | 신호등 정지/재시작 버튼, 내부 풀업(Input Pull-up) |
| **D5**  | 버튼2 | 전체 LED 깜빡이기 버튼, 내부 풀업(Input Pull-up) |
| **D6**  | 버튼3 | 신호등 초기화 버튼, 내부 풀업(Input Pull-up) |
| **A0**  | 가변저항 | 0-1023 범위를 읽어 LED 밝기(0-255)로 매핑 |
| **5V/GND** | 전원, 접지 | LED, 버튼, 가변저항에 전력 공급 및 회로 구성 위한 공통 접지 |



## **코드 구성 및 동작 방식**  


✔ redTime, yellowTime, greenTime → 신호등 점등 시간
✔ brightness → LED 밝기 값
✔ currentLight → 현재 점등 중인 신호등 색
✔ mode → "normal" 상태일 때만 신호등이 동작


✔ createCanvas(500, 600); → 500x600 크기의 캔버스 생성
✔ serial = new p5.SerialPort(); → 시리얼 포트 연결을 위한 객체 생성
✔ createButton("아두이노 연결"); → 아두이노 연결 버튼 생성
✔ createSlider(0, 255, 255); → LED 밝기를 조절하는 슬라이더 추가


✔ drawTrafficLights(); → 신호등을 화면에 그리는 함수 호출
✔ updateTrafficLight(); → 신호등 상태를 업데이트하는 함수 호출
✔ brightnessSlider.value(); → 사용자가 선택한 밝기 값 반영


---

## 회로 연결 이미지

아래 이미지는 틴커캐드로 구현한 대략적인 회로입니다.
![스크린샷 2025-03-16 150852](https://github.com/user-attachments/assets/03bead83-e5e5-4b03-8b2d-1a67d55cd31d)



실제 구현 회로는 아래와 같습니다.
![KakaoTalk_20250316_111255504](https://github.com/user-attachments/assets/a8b4d77c-03ac-46c0-8beb-94dabbb0b700)


---




# 🚦 p5.js 기반 신호등 시뮬레이션  
이 프로젝트는 **p5.js**를 사용하여 신호등을 시뮬레이션하는 웹 애플리케이션입니다.  
사용자는 슬라이더를 이용해 **신호등의 점등 시간**을 조절하고, **아두이노와 시리얼 통신을 통해 실제 LED를 제어**할 수 있습니다.  

![image](https://github.com/user-attachments/assets/ac3604ad-cc82-47fb-8e7a-ebd12e151367)


---

## **📡 아두이노 ↔ p5.js 양방향 데이터 흐름**

### **📡 시리얼 통신 프로토콜**
| 데이터 형식 | 설명 |
|------------|------------------------|
| `1` | 신호등 기능 ON |
| `0` | 신호등 기능 OFF |
| `r` | 빨간불 only |
| `b` | 모든 LED 깜빡이기 |
| `BUTTON1_ON` | 버튼 1이 눌림 (Arduino → p5.js) |
| `BUTTON1_OFF` | 버튼 1에서 손 뗌 (Arduino → p5.js) |
| `BUTTON2_ON` | 버튼 2가 눌림 (Arduino → p5.js) |
| `BUTTON2_OFF` | 버튼 2에서 손 뗌 (Arduino → p5.js) |
| `BUTTON3_ON` | 버튼 3이 눌림 (Arduino → p5.js) |
| `BUTTON3_OFF` | 버튼 3에서 손 뗌 (Arduino → p5.js) |
| `BRIGHTNESS: [0-255]` | 가변저항 밝기 값 (Arduino → p5.js) |
| `BRIGHTNESS_SET: [0-255]` | p5.js에서 설정한 밝기 값 (p5.js → Arduino) |

---

## **실행 방법**
### **1️⃣. 아두이노 코드 업로드**
1. **VS Code**에서 **PlatformIO** 확장 프로그램을 설치  
   - VS Code에서 `Extensions (Ctrl+Shift+X)` → `PlatformIO IDE` 검색 후 설치
2. **프로젝트 열기**  
   - `TrafficLight.ino` 파일이 포함된 폴더를 VS Code에서 엽니다.
3. **아두이노 보드 연결**
   - USB 케이블을 통해 아두이노를 PC에 연결합니다.
4. **코드 업로드 (`Ctrl+Alt+U`)**  
   - VS Code에서 `PlatformIO: Upload` 버튼을 클릭하거나 단축키 `Ctrl+Alt+U`를 눌러 업로드합니다.

### **2️⃣. 웹 UI 실행 (p5.js)**
1. **VS Code Live Server 실행**
   - `Extensions (Ctrl+Shift+X)`에서 `Live Server` 검색 후 설치  
   - `index.html` 파일을 열고 **오른쪽 하단의 "Go Live" 버튼** 클릭  
   - 또는 `Alt+L` → `Alt+O` 단축키를 사용하여 실행  
2. **웹 브라우저에서 접속**
   - `http://127.0.0.1:5500/` 또는 `http://localhost:5500/` 에 접속

### **3️⃣. Arduino 연결 및 조작**
1. **"아두이노 연결/해제" 버튼 클릭** → 시리얼 포트 선택
2. **UI에서 버튼 클릭** 또는 **슬라이더 조절**
3. 아두이노 보드에서 **버튼을 눌러 LED 제어** 가능
4. **가변저항 조절** 시 웹 UI에서 밝기 반영


---

## **마무리**
이 프로젝트는 **Arduino와 p5.js의 양방향 통신을 활용한 신호등 시스템**을 구현하는 예제입니다.  
🔹 **버튼, 가변저항, 시리얼 통신을 연습하기 좋은 프로젝트**입니다!

---
